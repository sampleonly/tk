define("pages/security/role/edit/edit",function(e,r,i){"use strict";var n=e("api"),s=e("msg");i.exports=Vue.extend({template:'\r\n<div>\r\n    <!-- mainview -->\r\n    <mainview :title="isNew ? \'新建\': \'编辑\'">\r\n        <breadcrumb slot="breadcrumb">\r\n            <breadcrumb-item link="/" class="am-icon-home">首页</breadcrumb-item>\r\n            <breadcrumb-item>系统安全</breadcrumb-item>\r\n            <breadcrumb-item link="/security/role">角色管理</breadcrumb-item>\r\n            <breadcrumb-item>{{isNew ? \'新建\': \'编辑\'}}</breadcrumb-item>\r\n        </breadcrumb>\r\n\r\n        <!-- mainview-body -->\r\n        <template>\r\n            <am-panel title="基本信息">\r\n                <div class="am-g">\r\n                    <div class="am-u-md-10 am-u-md-offset-1">\r\n                        <form class="am-form am-form-horizontal">\r\n                            <div class="am-form-group">\r\n                                <div class="am-u-md-2">\r\n                                    <label class="am-form-label">角色名</label>\r\n                                </div>\r\n                                <div class="am-u-md-8 am-u-end">\r\n                                    <input type="text" v-model="model.roleName" class="am-input-sm" placeholder="角色名">\r\n                                </div>\r\n                            </div>\r\n                            <div class="am-form-group">\r\n                                <div class="am-u-md-2">\r\n                                    <label class="am-form-label">角色描述</label>\r\n                                </div>\r\n                                <div class="am-u-md-8 am-u-end">\r\n                                    <input type="text" v-model="model.roleDesc" class="am-input-sm" placeholder="角色描述">\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div class="am-form-group">\r\n                                <div class="am-u-md-10 am-u-md-offset-2">\r\n                                    <form-submit @submit="submit"></form-submit>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </am-panel>\r\n\r\n            <am-panel title="权限配置" v-if="!isNew">\r\n                <div class="am-g">\r\n                    <div class="am-u-md-10 am-u-md-offset-1">\r\n                        <form class="am-form am-form-horizontal">\r\n                            <div class="am-form-group">\r\n                                <div class="am-u-md-8 am-u-md-offset-2">\r\n                                    <ui-permission-picker v-if="permissionReady" :permissions="permissions" :picked.sync="permitted"></ui-permission-picker>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div class="am-form-group">\r\n                                <div class="am-u-md-10 am-u-md-offset-2">\r\n                                    <button @click.prevent="savePermissions" class="am-btn am-btn-default am-btn-sm"><i class="am-icon-save"></i> 保存权限</button>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </am-panel>\r\n        </template><!--/ mainview-body -->\r\n    </mainview><!--/ mainview -->\r\n</div>\r\n',mixins:[e("mixins/isNew")],data:function(){return{model:{id:null,roleName:null,roleDesc:null},permissions:null,permitted:null}},computed:{permissionReady:function(){return!(!this.permissions||!this.permitted)}},methods:{submit:function(){var e=this;this.isNew?n.security.role.create(this.model).then(function(){e.permitted=[],s.alert("保存成功","success")}):n.security.role.update(this.model).then(function(){s.alert("保存成功","success")})},savePermissions:function(){n.security.role.grant(this.model.id,this.permitted.join(",")).then(function(){s.alert("保存成功","success")})}},route:{data:function(){var e=this,r=this.$route.params.id;this.isNew?n.security.permission.fetch().then(function(r){e.permissions=r.data}):(n.security.role.get(r).then(function(r){e.model={id:r.data.id,roleName:r.data.roleName,roleDesc:r.data.roleDesc}}),$.when(n.security.permission.fetch(),n.security.role.fetchPermissions(r)).then(function(r,i){var n=r[0].data,s=i[1].data;e.permissions=n,e.permitted=$.map(s,function(e){return e.id})}))}},components:{"ui-permission-picker":e("components/permission-picker/permission-picker")}})});